{
  "version": 3,
  "sources": [
    "unknown"
  ],
  "names": [],
  "mappings": "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",
  "file": "unknown",
  "sourcesContent": [
    "cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n       \r\n        AnimName : '',\r\n        \r\n        loc: cc.v2(0, 0),\r\n        \r\n        collision : false,\r\n        \r\n        reachedTarget : false,\r\n        \r\n        bullet: {\r\n            default: null,\r\n            type: cc.Node\r\n        }\r\n        \r\n    },\r\n    \r\n    changeDirection: function(dir){\r\n        this.getComponent(cc.Animation).play(this.AnimName + dir);\r\n        \r\n    },\r\n\r\n   moveToPoint(x,y){\r\n     this.loc.x = x;\r\n     this.loc.y = y;\r\n     \r\n     //cc.moveTo(1,cc.p(x, y));\r\n     \r\n     //没有碰撞，可以移动\r\n     if (!this.collision)\r\n          this.node.runAction( cc.moveTo(1,cc.p(x, y)));\r\n          \r\n    //this.fire(this.loc);\r\n\r\n   },\r\n\r\n    onLoad: function () {\r\n         cc.director.getCollisionManager().enabled = true;  \r\n    },\r\n    \r\n    //开火，动态生成子弹\r\n    fire: function(loc){\r\n         var scene = cc.director.getScene();  \r\n         var touchLoc = loc;\r\n         var bullet = cc.instantiate(this.bullet);\r\n         //bullet.hero = this;\r\n         bullet.position = touchLoc;\r\n         bullet.active = true;\r\n         scene.addChild(bullet);\r\n    },\r\n    \r\n    refire: function(){\r\n        if (this.reachedTarget){\r\n          var stopLoc = cc.v2(this.node.x, this.node.y);\r\n          this.fire(stopLoc);\r\n        }\r\n    },\r\n    \r\n    onCollisionEnter: function (other, self) {\r\n        //console.log('onCollisionEnter ' + self.tag);\r\n        \r\n        //tag 11表示人物本身，33为子弹，除了碰到自己的子弹外，碰撞变量置为true，停止运动\r\n        if (self.tag == 11 && other.tag != 33){\r\n          this.collision = true;\r\n          this.node.stopAllActions();\r\n        } \r\n        \r\n        //tag 22为攻击范围检测，1,2,3代表敌方建筑,满足开火条件\r\n        if ((self.tag == 22 && (other.tag == 1 || other.tag == 2 || other.tag == 3))){\r\n            this.reachedTarget = true;\r\n            var stopLoc = cc.v2(this.node.x, this.node.y);\r\n            this.fire(stopLoc);\r\n        }\r\n    },\r\n    \r\n    onCollisionStay: function (other, self) {\r\n        \r\n        //人物碰到除自己子弹外的物体，往相应反方向退一格，以避免碰撞后慢慢穿越物体。\r\n        if (self.tag == 11 && other.tag != 33){\r\n          this.collision = true;\r\n        \r\n          var otherAabb = other.world.aabb;\r\n          var selfAabb = self.world.aabb.clone();\r\n          var preAabb = self.world.preAabb;\r\n        \r\n          //selfAabb.x = preAabb.x;\r\n          //selfAabb.y = preAabb.y;\r\n        \r\n          //selfAabb.x = self.world.aabb.x;\r\n          if (cc.Intersection.rectRect(selfAabb, otherAabb)) {\r\n            //左右碰撞，往x方向退格\r\n            if (selfAabb.xMax > otherAabb.xMax) {\r\n                this.node.x += 1;\r\n            }\r\n            else if (selfAabb.xMin < otherAabb.xMin) {\r\n                this.node.x -= 1;\r\n            }\r\n\r\n          }\r\n          \r\n          //上下碰撞，y方向退格\r\n          selfAabb.y = self.world.aabb.y;\r\n          if (cc.Intersection.rectRect(selfAabb, otherAabb)) {\r\n            if (selfAabb.yMax > otherAabb.yMax) {\r\n                this.node.y += 1;\r\n\r\n            }\r\n            else if (selfAabb.yMin < otherAabb.yMin) {\r\n                this.node.y -= 1;\r\n            }\r\n\r\n          }    \r\n          //this.node.y -= 1;\r\n          //this.node.stopAllActions();\r\n        }\r\n        \r\n        //碰到敌方建筑，开火条件依然满足\r\n        if ((self.tag == 22 && (other.tag == 1 || other.tag == 2 || other.tag == 3))){\r\n          this.reachedTarget = true;\r\n      }\r\n    },\r\n    \r\n    onCollisionExit: function (other, self) {\r\n      //碰撞结束，变量置为false，人物可以继续移动\r\n      if (self.tag == 11 && other.tag != 33){\r\n       this.collision = false;\r\n      } \r\n      \r\n      //离开攻击范围,变量置为false,结束攻击\r\n      if ((self.tag == 22 && (other.tag == 1 || other.tag == 2 || other.tag == 3))){\r\n        this.reachedTarget = false;\r\n      }\r\n    },\r\n\r\n    \r\n    update: function (dt) {\r\n /*       \r\n        if (!this.collision){\r\n         if (Math.floor(this.node.x) != Math.floor(this.loc.x)){\r\n            if (this.loc.x - this.node.x < 0)\r\n              this.node.x--;\r\n            else \r\n              this.node.x++;\r\n              \r\n           // console.log('x=' + this.node.x);\r\n         }\r\n        \r\n          if (Math.floor(this.node.y) != Math.floor(this.loc.y)){\r\n            if (this.loc.y - this.node.y < 0)\r\n              this.node.y--;\r\n            else \r\n              this.node.y++;\r\n              \r\n           // console.log('y=' + this.node.y);\r\n          }\r\n        }\r\n        */\r\n    },\r\n\r\n});\r\n"
  ]
}